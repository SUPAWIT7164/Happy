// Happy Birthday Interactive Effects with Games
document.addEventListener('DOMContentLoaded', function() {
    
    // Initialize all interactive features
    initCharacterInteractions();
    initFlowerInteractions();
    initCakeInteraction();
    initRandomFloatingElements();
    initBirthdayMusic();
    initConfettiOnLoad();
    initPhotoFrame();
    initCountdown();
    initBirthdayGirlInteraction();
    initCheerPhotosInteraction();
    
    // Set initial volume and setup audio
    const audio = document.getElementById('birthday-song');
    if (audio) {
        audio.volume = 0.8; // Set to 80% volume for better experience
        
        // Add event listeners for debugging
        audio.addEventListener('loadstart', () => {
            console.log('Audio loading started');
            showMessage('р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╣Ар╕Юр╕ер╕З MP3... р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И ЁЯО╡');
        });
        
        audio.addEventListener('canplay', () => {
            console.log('Audio can play');
            showMessage('р╣Ар╕Юр╕ер╕З MP3 р╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з! ЁЯО╡');
        });
        
        audio.addEventListener('canplaythrough', () => {
            console.log('Audio can play through');
            showMessage('р╣Ар╕Юр╕ер╕З MP3 р╣Вр╕лр╕ер╕Фр╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з! ЁЯО╡');
        });
        
        audio.addEventListener('error', (e) => {
            console.error('Audio error:', e);
            console.error('Error details:', e.target.error);
            showMessage('р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣М MP3 р╣Др╕Фр╣Й р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М ЁЯО╡');
            
            // Show more detailed error message
            if (e.target.error) {
                switch(e.target.error.code) {
                    case e.target.error.MEDIA_ERR_ABORTED:
                        showMessage('р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣М MP3 р╕Цр╕╣р╕Бр╕вр╕Бр╣Ар╕ер╕┤р╕Б ЁЯО╡');
                        break;
                    case e.target.error.MEDIA_ERR_NETWORK:
                        showMessage('р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣М MP3 р╕Ир╕▓р╕Бр╣Ар╕Др╕гр╕╖р╕нр╕Вр╣Ир╕▓р╕в ЁЯО╡');
                        break;
                    case e.target.error.MEDIA_ERR_DECODE:
                        showMessage('р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Цр╕нр╕Фр╕гр╕лр╕▒р╕кр╣Др╕Яр╕ер╣М MP3 р╣Др╕Фр╣Й р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Яр╕ер╣М ЁЯО╡');
                        break;
                    case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
                        showMessage('р╣Др╕Яр╕ер╣М MP3 р╣Др╕бр╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ъ р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╣Др╕Яр╕ер╣М ЁЯО╡');
                        break;
                    default:
                        showMessage('р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣М MP3 ЁЯО╡');
                }
            }
        });
        
        audio.addEventListener('play', () => {
            console.log('Audio started playing');
            showMessage('ЁЯО╡ р╣Ар╕Юр╕ер╕Зр╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕ер╣Ир╕Щр╣Бр╕ер╣Йр╕з! ЁЯО╡');
        });
        
        audio.addEventListener('pause', () => {
            console.log('Audio paused');
        });
        
        audio.addEventListener('ended', () => {
            console.log('Audio ended, restarting...');
            audio.currentTime = 0;
            audio.play();
        });
    }
    
    // Start music after page loads
    setTimeout(() => {
        // Check if MP3 file exists and can be loaded
        const audio = document.getElementById('birthday-song');
        if (audio) {
            console.log('=== Audio Debug Info ===');
            console.log('Audio element:', audio);
            console.log('Audio src:', audio.src);
            console.log('Audio readyState:', audio.readyState);
            console.log('Audio networkState:', audio.networkState);
            console.log('Audio error:', audio.error);
            
            // Test if file can be loaded
            const testAudio = new Audio();
            testAudio.src = 'Happy Birthday song Romantic version romantic piano version.mp3';
            testAudio.addEventListener('loadstart', () => console.log('Test audio: loadstart'));
            testAudio.addEventListener('canplay', () => console.log('Test audio: canplay'));
            testAudio.addEventListener('error', (e) => console.error('Test audio error:', e));
        }
        
        startMusic();
    }, 2000); // Start after 2 seconds
    
    // Initialize Birthday Girl Interaction
    initBirthdayGirlInteraction();
    
    // Initialize Cheer Photos Interaction
    initCheerPhotosInteraction();
    
    // Character interactions
    function initCharacterInteractions() {
        const characters = document.querySelectorAll('.character');
        
        characters.forEach(character => {
            character.addEventListener('click', function() {
                // Add special animation on click
                this.style.transform = 'scale(1.2) rotate(360deg)';
                
                // Show character message
                showCharacterMessage(this);
                
                // Reset animation after 1 second
                setTimeout(() => {
                    this.style.transform = '';
                }, 1000);
                
                // Create floating hearts from character
                createFloatingHeartsFromElement(this);
            });
            
            // Add hover sound effect (visual feedback)
            character.addEventListener('mouseenter', function() {
                this.style.boxShadow = '0 20px 40px rgba(255, 107, 157, 0.3)';
            });
            
            character.addEventListener('mouseleave', function() {
                this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.1)';
            });
        });
    }
    
    // Birthday Girl Interaction
    function initBirthdayGirlInteraction() {
        const birthdayGirl = document.querySelector('.birthday-girl-photo');
        
        if (birthdayGirl) {
            birthdayGirl.addEventListener('click', function() {
                const messages = [
                    'ЁЯОВ р╕кр╕╕р╕Вр╕кр╕▒р╕Щр╕Хр╣Мр╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕бр╕▓р╕Бр╣Ж р╣Гр╕Щр╕зр╕▒р╕Щр╕Юр╕┤р╣Ар╕ир╕йр╕Щр╕╡р╣Й! ЁЯМЯ',
                    'ЁЯОЙ р╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Вр╕нр╕Зр╣Ар╕Шр╕н! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Хр╣Зр╕бр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕гр╕нр╕вр╕вр╕┤р╣Йр╕б р╣Ар╕кр╕╡р╕вр╕Зр╕лр╕▒р╕зр╣Ар╕гр╕▓р╕░ р╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕Чр╕гр╕Зр╕Ир╕│р╕Фр╕╡р╣Ж! тЬи',
                    'ЁЯОБ р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╕нр╕Зр╕Вр╕зр╕▒р╕Нр╕Чр╕╡р╣Ир╕кр╕зр╕вр╕Зр╕▓р╕бр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╣Гр╕Щр╕Кр╕╡р╕зр╕┤р╕Х! р╕Др╕зр╕▓р╕бр╕гр╕▒р╕Б р╕Др╕зр╕▓р╕бр╕кр╕╕р╕В р╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕И! ЁЯТЦ',
                    'ЁЯМИ р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕зр╕вр╕Зр╕▓р╕бр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╣Гр╕Щр╕Ыр╕╡! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╣Др╕Фр╣Йр╕Чр╕│р╣Гр╕Щр╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Кр╕нр╕Ъ р╣Бр╕ер╕░р╕бр╕╡р╕Др╕Щр╕Чр╕╡р╣Ир╕гр╕▒р╕Бр╕нр╕вр╕╣р╣Ир╣Ар╕Др╕╡р╕вр╕Зр╕Вр╣Йр╕▓р╕З! ЁЯе░',
                    'ЁЯОК р╕зр╕▒р╕Щр╕Юр╕┤р╣Ар╕ир╕йр╕Вр╕нр╕Зр╣Ар╕Шр╕н! р╕Вр╕нр╣Гр╕лр╣Йр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕бр╕▓р╕Бр╣Ж р╣Бр╕ер╕░р╣Др╕Фр╣Йр╕Чр╕│р╣Гр╕Щр╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Эр╕▒р╕Щр╣Др╕зр╣Й! ЁЯМа'
                ];
                
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                showMessage(randomMessage);
                
                // Trigger confetti
                createConfetti();
                
                // Add floating hearts
                createFloatingHearts();
            });
            
            // Add hover effects
            birthdayGirl.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
                this.style.cursor = 'pointer';
            });
            
            birthdayGirl.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        }
    }
    
    // Cheer Photos Interaction
    function initCheerPhotosInteraction() {
        const cheerItems = document.querySelectorAll('.cheer-item');
        
        cheerItems.forEach((item, index) => {
            item.addEventListener('click', function() {
                const messages = [
                    'ЁЯУ╕ р╕ар╕▓р╕Юр╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕Чр╕╡р╣Ир╕кр╕зр╕вр╕Зр╕▓р╕б! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕бр╕▓р╕Бр╣Ж! ЁЯМЯ',
                    'ЁЯОЙ р╕ар╕▓р╕Юр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕Чр╕гр╕Зр╕Ир╕│! р╕Вр╕нр╣Гр╕лр╣Йр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Щр╣Ир╕▓р╕Ир╕Фр╕Ир╕│р╕Чр╕╡р╣Ир╕кр╕╕р╕Ф! тЬи',
                    'ЁЯТЦ р╕ар╕▓р╕Юр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Б! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Др╕зр╕▓р╕бр╕гр╕▒р╕Бр╕бр╕▓р╕Бр╕бр╕▓р╕вр╣Гр╕Щр╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф! ЁЯе░',
                    'ЁЯМИ р╕ар╕▓р╕Юр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕Эр╕▒р╕Щ! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╣Др╕Фр╣Йр╕Чр╕│р╣Гр╕Щр╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Эр╕▒р╕Щр╣Др╕зр╣Й! ЁЯМа',
                    'ЁЯОК р╕ар╕▓р╕Юр╣Бр╕лр╣Ир╕Зр╕Бр╕▓р╕гр╣Ар╕Йр╕ер╕┤р╕бр╕Йр╕ер╕нр╕З! р╕Вр╕нр╣Гр╕лр╣Йр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕Щр╕╕р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф! ЁЯОИ'
                ];
                
                const randomMessage = messages[index % messages.length];
                showMessage(randomMessage);
                
                // Trigger different effects based on photo index
                if (index % 2 === 0) {
                    createConfetti();
                } else {
                    createFloatingHearts();
                }
            });
            
            // Add hover effects
            item.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
                this.style.cursor = 'pointer';
            });
            
            item.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        });
    }
    
    // Show character specific messages
    function showCharacterMessage(character) {
        const messages = {
            'maruko': [
                'р╕бр╕▓р╕гр╕╕р╣Вр╕Бр╕░р╕Вр╕нр╣Гр╕лр╣Йр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕бр╕▓р╕Бр╣Ж р╕Щр╕░р╕Др╕░! р╕Вр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╣Ж р╕зр╕▒р╕Щр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕зр╕вр╕Зр╕▓р╕бр╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Фр╕нр╕Бр╕Лр╕▓р╕Бр╕╕р╕гр╕░р╕Чр╕╡р╣Ир╕Ър╕▓р╕Щр╕кр╕░р╕Юр╕гр╕▒р╣Ир╕З р╣Бр╕ер╕░р╕Вр╕нр╣Гр╕лр╣Йр╕бр╕╡р╣Ар╕Юр╕╖р╣Ир╕нр╕Щр╕Фр╕╡р╣Ж р╕гр╕нр╕Ър╕Вр╣Йр╕▓р╕Зр╕Хр╕ер╕нр╕Фр╣Др╕Ы! ЁЯМ╕ЁЯТХ',
                'р╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Фр╕Щр╕╡р╣Йр╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Юр╕┤р╣Ар╕ир╕йр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╣Ар╕ер╕в! р╕бр╕▓р╕гр╕╕р╣Вр╕Бр╕░р╕лр╕зр╕▒р╕Зр╕зр╣Ир╕▓р╣Ар╕Шр╕нр╕Ир╕░р╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╣Ар╕вр╕нр╕░р╣Ж р╕бр╕╡р╕гр╕нр╕вр╕вр╕┤р╣Йр╕бр╕кр╕Фр╣Гр╕кр╣Бр╕ер╕░р╣Др╕Фр╣Йр╕Чр╕│р╣Гр╕Щр╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Кр╕нр╕Ър╕Чр╕╕р╕Бр╕зр╕▒р╕Щ! р╕Вр╕нр╣Гр╕лр╣Йр╣Вр╕Кр╕Др╕Фр╕╡р╣Гр╕Щр╕Чр╕╕р╕Бр╣Ар╕гр╕╖р╣Ир╕нр╕Зр╕Щр╕░! ЁЯМ╕тЬи'
            ],
            'reborn': [
                'р╕гр╕╡р╕Ър╕нр╕гр╣Мр╕Щр╕нр╕зр╕вр╕Юр╕гр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╣Ар╕Ыр╣Зр╕Щр╕кр╕▓р╕зр╕Чр╕╡р╣Ир╕Щр╣Ир╕▓р╕гр╕▒р╕Бр╕Хр╕ер╕нр╕Фр╣Др╕Ы! р╕Вр╕нр╣Гр╕лр╣Йр╕бр╕╡р╕Юр╕ер╕▒р╕Зр╕нр╕│р╕Щр╕▓р╕Ир╣Гр╕Щр╕Бр╕▓р╕гр╕Чр╕│р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕Эр╕▒р╕Щр╣Ар╕Ыр╣Зр╕Щр╕Ир╕гр╕┤р╕З р╣Бр╕ер╕░р╕бр╕╡р╕Др╕зр╕▓р╕бр╣Бр╕Вр╣Зр╕Зр╣Бр╕Бр╕гр╣Ир╕Зр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕Ьр╕Кр╕┤р╕Нр╕лр╕Щр╣Йр╕▓р╕Бр╕▒р╕Ър╕нр╕╕р╕Ыр╕кр╕гр╕гр╕Др╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕З! ЁЯССЁЯТк',
                'р╕Вр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕Др╕зр╕▓р╕бр╕Эр╕▒р╕Щр╣Ар╕Ыр╣Зр╕Щр╕Ир╕гр╕┤р╕Зр╕Щр╕░р╕Др╕░! р╕гр╕╡р╕Ър╕нр╕гр╣Мр╕Щр╕Ир╕░р╕Ыр╕Бр╕Ыр╣Йр╕нр╕Зр╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕Вр╕нр╕Зр╣Ар╕Шр╕нр╣Ар╕кр╕бр╕н р╕Вр╕нр╣Гр╕лр╣Йр╕бр╕╡р╕Ьр╕╣р╣Йр╕Др╕Щр╕Чр╕╡р╣Ир╕гр╕▒р╕Бр╣Бр╕ер╕░р╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕нр╕вр╕╣р╣Ир╕гр╕нр╕Ър╕Вр╣Йр╕▓р╕З р╣Бр╕ер╕░р╕Вр╕нр╣Гр╕лр╣Йр╕Кр╕╡р╕зр╕┤р╕Хр╣Ар╕Хр╣Зр╕бр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Бр╕▓р╕гр╕Ьр╕Ир╕Нр╕ар╕▒р╕вр╕Чр╕╡р╣Ир╕Щр╣Ир╕▓р╕Хр╕╖р╣Ир╕Щр╣Ар╕Хр╣Йр╕Щ! тЬиЁЯФе'
            ],
            'shinchan': [
                'р╕Кр╕┤р╕Щр╕Ир╕▒р╕Зр╕Вр╕нр╣Гр╕лр╣Йр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╣Бр╕ер╕░р╕гр╕нр╕вр╕вр╕┤р╣Йр╕бр╕кр╕Фр╣Гр╕кр╕Хр╕ер╕нр╕Фр╣Др╕Ы! р╕Вр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕зр╕▒р╕Щр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕Щр╕╕р╕Бр╕кр╕Щр╕▓р╕Щ р╕бр╕╡р╣Ар╕гр╕╖р╣Ир╕нр╕Зр╕Хр╕ер╕Бр╣Ж р╣Гр╕лр╣Йр╕лр╕▒р╕зр╣Ар╕гр╕▓р╕░ р╣Бр╕ер╕░р╕бр╕╡р╕Вр╕Щр╕бр╕нр╕гр╣Ир╕нр╕вр╣Ж р╣Гр╕лр╣Йр╕Бр╕┤р╕Щр╕Чр╕╕р╕Бр╕зр╕▒р╕Щ! р╕Кр╕┤р╕Щр╕Ир╕▒р╕Зр╕гр╕▒р╕Бр╣Ар╕Шр╕нр╕бр╕▓р╕Бр╕Щр╕░! ЁЯШКЁЯНн',
                'р╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Фр╕Щр╕╡р╣Йр╕Хр╣Йр╕нр╕Зр╕кр╕Щр╕╕р╕Бр╣Бр╕ер╕░р╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕бр╕▓р╕Бр╣Ж р╕Щр╕░! р╕Кр╕┤р╕Щр╕Ир╕▒р╕Зр╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Шр╕нр╕бр╕╡р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕зр╕Чр╕╡р╣Ир╕нр╕Ър╕нр╕╕р╣Ир╕Щ р╣Ар╕Юр╕╖р╣Ир╕нр╕Щр╕Чр╕╡р╣Ир╕Фр╕╡ р╣Бр╕ер╕░р╣Др╕Фр╣Йр╣Ар╕ер╣Ир╕Щр╕кр╕Щр╕╕р╕Бр╣Ж р╕Чр╕╕р╕Бр╕зр╕▒р╕Щ! р╕лр╣Йр╕▓р╕бр╣Ар╕ир╕гр╣Йр╕▓р╣Ар╕ер╕вр╕Щр╕░ р╕Хр╣Йр╕нр╕Зр╕вр╕┤р╣Йр╕бр╣Гр╕лр╣Йр╕кр╕Фр╣Гр╕кр╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Кр╕┤р╕Щр╕Ир╕▒р╕Зр╣Ар╕кр╕бр╕н! ЁЯОЙЁЯМИ'
            ]
        };
        
        let characterType = 'maruko';
        if (character.classList.contains('reborn')) characterType = 'reborn';
        if (character.classList.contains('shinchan')) characterType = 'shinchan';
        
        const randomMessage = messages[characterType][Math.floor(Math.random() * messages[characterType].length)];
        
        // Create message popup using the global showMessage function for better visibility
        showMessage(randomMessage);
        
        // Also create a small popup above character for visual feedback
        const miniMessageDiv = document.createElement('div');
        miniMessageDiv.className = 'character-mini-message';
        miniMessageDiv.textContent = 'ЁЯТм';
        miniMessageDiv.style.cssText = `
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 107, 157, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 50%;
            font-size: 1.2rem;
            z-index: 1000;
            animation: messageSlideIn 0.5s ease-out;
            pointer-events: none;
        `;
        
        character.style.position = 'relative';
        character.appendChild(miniMessageDiv);
        
        // Remove mini message after 2 seconds
        setTimeout(() => {
            if (miniMessageDiv.parentNode) {
                miniMessageDiv.remove();
            }
        }, 2000);
    }
    
    // Flower interactions
    function initFlowerInteractions() {
        const flowers = document.querySelectorAll('.flower');
        
        flowers.forEach(flower => {
            flower.addEventListener('click', function() {
                // Create blooming effect
                this.style.transform = 'scale(1.5) rotate(360deg)';
                this.style.filter = 'brightness(1.5)';
                
                // Create petal explosion
                createPetalExplosion(this);
                
                // Reset after animation
                setTimeout(() => {
                    this.style.transform = '';
                    this.style.filter = '';
                }, 800);
            });
        });
    }
    
    // Create petal explosion effect
    function createPetalExplosion(element) {
        const petals = ['ЁЯМ╕', 'ЁЯМ║', 'ЁЯМ╣', 'ЁЯМ╗', 'ЁЯМ╖'];
        const rect = element.getBoundingClientRect();
        
        for (let i = 0; i < 8; i++) {
            const petal = document.createElement('div');
            petal.textContent = petals[Math.floor(Math.random() * petals.length)];
            petal.style.cssText = `
                position: fixed;
                left: ${rect.left + rect.width/2}px;
                top: ${rect.top + rect.height/2}px;
                font-size: 1.5rem;
                pointer-events: none;
                z-index: 1000;
                animation: petalFly 2s ease-out forwards;
            `;
            
            // Random direction for each petal
            const angle = (360 / 8) * i;
            const distance = 100 + Math.random() * 50;
            petal.style.setProperty('--angle', angle + 'deg');
            petal.style.setProperty('--distance', distance + 'px');
            
            document.body.appendChild(petal);
            
            // Remove after animation
            setTimeout(() => petal.remove(), 2000);
        }
    }
    
    // Cake interaction - Enhanced with blow feature
    function initCakeInteraction() {
        const cake = document.querySelector('.birthday-cake');
        let candlesLit = true;
        
        cake.addEventListener('click', function() {
            if (candlesLit) {
                blowCandles();
            } else {
                lightCandles();
            }
        });
        
        // Keyboard support for blowing
        document.addEventListener('keydown', function(e) {
            if (e.key.toLowerCase() === 'b' && candlesLit) {
                blowCandles();
            }
        });
        
        // Set initial state
        window.candlesLit = true;
    }
    


    

    
    // Random floating elements continuously (reduced frequency)
    function initRandomFloatingElements() {
        setInterval(() => {
            // Only create element 50% of the time
            if (Math.random() < 0.5) {
                createRandomFloatingElement();
            }
        }, 5000); // Increased interval from 3s to 5s
    }
    
    function createRandomFloatingElement() {
        const elements = ['тЬи', 'ЁЯМЯ', 'ЁЯТл', 'ЁЯжЛ', 'ЁЯМ╕']; // Removed heart
        const element = document.createElement('div');
        element.textContent = elements[Math.floor(Math.random() * elements.length)];
        element.style.cssText = `
            position: fixed;
            left: ${Math.random() * 100}vw;
            bottom: -50px;
            font-size: 1.2rem;
            pointer-events: none;
            z-index: 1;
            animation: floatUpSlow 8s linear forwards;
            opacity: 0.5;
        `;
        
        document.body.appendChild(element);
        
        setTimeout(() => element.remove(), 8000);
    }
    
    // Birthday music toggle (visual indication)
    function initBirthdayMusic() {
        const musicNote = document.createElement('div');
        musicNote.innerHTML = 'ЁЯО╡';
        musicNote.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            cursor: pointer;
            z-index: 1000;
            animation: musicBounce 2s ease-in-out infinite;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        `;
        
        let isPlaying = false;
        musicNote.addEventListener('click', function() {
            isPlaying = !isPlaying;
            this.innerHTML = isPlaying ? 'ЁЯО╢' : 'ЁЯО╡';
            showMessage(isPlaying ? 'р╣Ар╕Ыр╕┤р╕Фр╣Ар╕Юр╕ер╕З! ЁЯО╡' : 'р╕Ыр╕┤р╕Фр╣Ар╕Юр╕ер╕З ЁЯФЗ');
        });
        
        document.body.appendChild(musicNote);
    }
    
    // Initial confetti on page load
    function initConfettiOnLoad() {
        setTimeout(() => {
            createConfetti();
        }, 1000);
    }
    
    // Add CSS animations dynamically
    const style = document.createElement('style');
    style.textContent = `
        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-50%) scale(0.5); }
            to { opacity: 1; transform: translateX(-50%) translateY(-50%) scale(1); }
        }
        
        @keyframes messageSlideOut {
            from { opacity: 1; transform: translateX(-50%) translateY(-50%) scale(1); }
            to { opacity: 0; transform: translateX(-50%) translateY(-50%) scale(0.5); }
        }
        
        @keyframes petalFly {
            to {
                transform: rotate(720deg) translate(var(--distance)) rotate(-720deg);
                opacity: 0;
            }
        }
        
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        @keyframes heartFloatUp {
            to {
                transform: translateY(-200px);
                opacity: 0;
            }
        }
        
        @keyframes floatUpSlow {
            to {
                transform: translateY(-100vh);
                opacity: 0;
            }
        }
        
        @keyframes musicBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    `;
    document.head.appendChild(style);
    
    // Add special birthday message on scroll
    let hasShownScrollMessage = false;
    window.addEventListener('scroll', function() {
        if (!hasShownScrollMessage && window.scrollY > 100) {
            hasShownScrollMessage = true;
            showMessage('р╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕ер╕Зр╣Др╕Ыр╕Фр╕╣р╕Вр╕нр╕Зр╕Вр╕зр╕▒р╕Нр╕Юр╕┤р╣Ар╕ир╕йр╕Щр╕░р╕Др╕░! ЁЯОБтЬи');
        }
    });
    
    // Add click anywhere for hearts effect (reduced frequency)
    document.addEventListener('click', function(e) {
        // Don't trigger on interactive elements
        if (!e.target.classList.contains('character') && 
            !e.target.classList.contains('flower') && 
            !e.target.classList.contains('birthday-cake')) {
            
            // Lower chance for surprise hearts
            if (Math.random() < 0.1) {
                const heart = document.createElement('div');
                heart.textContent = 'ЁЯТХ';
                heart.style.cssText = `
                    position: fixed;
                    left: ${e.clientX}px;
                    top: ${e.clientY}px;
                    font-size: 1.2rem;
                    pointer-events: none;
                    z-index: 1000;
                    animation: heartFloatUp 2s ease-out forwards;
                `;
                
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 2000);
            }
        }
    });
});

// Show temporary messages
function showMessage(text) {
    const messageDiv = document.createElement('div');
    messageDiv.innerHTML = `
        <div style="margin-bottom: 10px; font-size: 1.2rem; font-weight: 600;">ЁЯТМ р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Юр╕┤р╣Ар╕ир╕й</div>
        <div style="line-height: 1.6; font-size: 1rem;">${text}</div>
        <button onclick="this.parentElement.remove()" style="
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            margin-top: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-family: 'Kanit', sans-serif;
        ">р╕Ыр╕┤р╕Ф тЬи</button>
    `;
    messageDiv.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 107, 157, 0.95);
        color: white;
        padding: 20px 25px;
        border-radius: 25px;
        font-weight: 500;
        z-index: 10000;
        box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        animation: messageSlideIn 0.5s ease-out;
        max-width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        text-align: center;
        font-family: 'Kanit', sans-serif;
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255,255,255,0.2);
    `;
    
    document.body.appendChild(messageDiv);
    
    // Auto close after 8 seconds if not manually closed
    setTimeout(() => {
        if (messageDiv.parentNode) {
            messageDiv.style.animation = 'messageSlideOut 0.5s ease-in forwards';
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 500);
        }
    }, 8000);
}

// Create confetti explosion
function createConfetti() {
    const confettiColors = ['ЁЯОК', 'ЁЯОЙ', 'тЬи', 'ЁЯМЯ', 'ЁЯТл'];
    
    for (let i = 0; i < 30; i++) {
        const confetti = document.createElement('div');
        confetti.textContent = confettiColors[Math.floor(Math.random() * confettiColors.length)];
        confetti.style.cssText = `
            position: fixed;
            left: ${Math.random() * 100}vw;
            top: -50px;
            font-size: ${1 + Math.random() * 2}rem;
            pointer-events: none;
            z-index: 1000;
            animation: confettiFall ${2 + Math.random() * 3}s ease-out forwards;
        `;
        
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 5000);
    }
}

// Create floating hearts from specific element
function createFloatingHeartsFromElement(element) {
    const hearts = ['ЁЯТХ', 'ЁЯТЦ'];
    const rect = element.getBoundingClientRect();
    
    for (let i = 0; i < 2; i++) {
        const heart = document.createElement('div');
        heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
        heart.style.cssText = `
            position: fixed;
            left: ${rect.left + Math.random() * rect.width}px;
            top: ${rect.top}px;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 1000;
            animation: heartFloatUp 3s ease-out forwards;
        `;
        
        document.body.appendChild(heart);
        
        setTimeout(() => heart.remove(), 3000);
    }
}

// Photo Frame Functions
function initPhotoFrame() {
    const photoArea = document.getElementById('photo-area');
    const photoInput = document.getElementById('photo-input');
    
    if (photoArea && photoInput) {
        photoArea.addEventListener('click', function() {
            photoInput.click();
        });
        
        photoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoArea.innerHTML = `<img src="${e.target.result}" alt="Uploaded photo">`;
                };
                reader.readAsDataURL(file);
            }
        });
    }
}

// Countdown Timer
function initCountdown() {
    updateCountdown();
    setInterval(updateCountdown, 1000);
}

function updateCountdown() {
    const now = new Date();
    const endOfDay = new Date();
    endOfDay.setHours(23, 59, 59, 999);
    
    const timeLeft = endOfDay - now;
    
    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
    const hoursEl = document.getElementById('hours');
    const minutesEl = document.getElementById('minutes');
    const secondsEl = document.getElementById('seconds');
    
    if (hoursEl) hoursEl.textContent = hours.toString().padStart(2, '0');
    if (minutesEl) minutesEl.textContent = minutes.toString().padStart(2, '0');
    if (secondsEl) secondsEl.textContent = seconds.toString().padStart(2, '0');
}

// Global Game Functions (accessible from HTML onclick)
let memoryMoves = 0;
let memoryCards = [];
let flippedCards = [];
let isMemoryGameActive = false;

// Memory Card Game
function startMemoryGame() {
    memoryMoves = 0;
    flippedCards = [];
    
    const movesElement = document.getElementById('memory-moves');
    const gameBoard = document.getElementById('memory-board');
    
    if (movesElement) {
        movesElement.textContent = memoryMoves;
    }
    
    if (gameBoard) {
        gameBoard.innerHTML = '';
        
        // Create card pairs
        const emojis = ['ЁЯМ╕', 'ЁЯМ║', 'ЁЯМ╣', 'ЁЯМ╗', 'ЁЯМ╖', 'ЁЯМ╝', 'ЁЯТЦ', 'тЬи'];
        memoryCards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
        
        memoryCards.forEach((emoji, index) => {
            const card = document.createElement('div');
            card.className = 'memory-card';
            card.dataset.emoji = emoji;
            card.dataset.index = index;
            
            card.innerHTML = `
                <div class="card-front">тЭУ</div>
                <div class="card-back">${emoji}</div>
            `;
            
            card.addEventListener('click', flipCard);
            gameBoard.appendChild(card);
        });
        
        isMemoryGameActive = true;
        showMessage('ЁЯза р╣Ар╕Бр╕бр╕Ир╕▒р╕Ър╕Др╕╣р╣Ир╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕ер╣Йр╕з! р╕Др╕ер╕┤р╕Бр╕Бр╕▓р╕гр╣Мр╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╕Юр╕ер╕┤р╕Б! ЁЯза');
    } else {
        console.error('р╣Др╕бр╣Ир╕Юр╕Ъ memory game board');
    }
}

function flipCard() {
    if (!isMemoryGameActive || this.classList.contains('flipped') || this.classList.contains('matched')) return;
    
    this.classList.add('flipped');
    flippedCards.push(this);
    
    if (flippedCards.length === 2) {
        memoryMoves++;
        const movesElement = document.getElementById('memory-moves');
        if (movesElement) {
            movesElement.textContent = memoryMoves;
        }
        
        setTimeout(checkMatch, 1000);
    }
}

function checkMatch() {
    const [card1, card2] = flippedCards;
    
    if (card1 && card2 && card1.dataset.emoji === card2.dataset.emoji) {
        card1.classList.add('matched');
        card2.classList.add('matched');
        
        // Check if all cards are matched
        if (document.querySelectorAll('.memory-card.matched').length === memoryCards.length) {
            setTimeout(() => {
                showMessage(`ЁЯОЙ р╕вр╕┤р╕Щр╕Фр╕╡р╕Фр╣Йр╕зр╕в! р╕Ир╕▒р╕Ър╕Др╕╣р╣Ир╕Др╕гр╕Ър╣Бр╕ер╣Йр╕зр╣Гр╕Щ ${memoryMoves} р╕Др╕гр╕▒р╣Йр╕З! ЁЯОЙ`);
                createConfetti();
            }, 500);
            isMemoryGameActive = false;
        }
    } else if (card1 && card2) {
        card1.classList.remove('flipped');
        card2.classList.remove('flipped');
    }
    
    flippedCards = [];
}



// Surprise Box Functions
function openSurpriseBox(boxNumber) {
    const box = document.querySelectorAll('.surprise-box')[boxNumber - 1];
    
    if (box.classList.contains('opened')) return;
    
    box.classList.add('opened');
    
    const surprises = [
        { emoji: 'ЁЯОВ', message: 'р╣Ар╕Др╣Йр╕Бр╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Фр╕Юр╕┤р╣Ар╕ир╕й! р╕лр╕зр╕▓р╕Щр╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Шр╕н!' },
        { emoji: 'ЁЯТЭ', message: 'р╕Вр╕нр╕Зр╕Вр╕зр╕▒р╕Нр╕Ир╕▓р╕Бр╣Гр╕И! р╣Ар╕Хр╣Зр╕бр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Б!' },
        { emoji: 'ЁЯМЯ', message: 'р╕Фр╕зр╕Зр╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕лр╕зр╕▒р╕З! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╕Ир╕гр╕┤р╕Зр╕Чр╕╕р╕Бр╕Др╕зр╕▓р╕бр╕Эр╕▒р╕Щ!' }
    ];
    
    const surprise = surprises[boxNumber - 1];
    box.querySelector('.box-content').textContent = surprise.emoji;
    
    setTimeout(() => {
        showMessage(surprise.message);
        createFloatingHeartsFromElement(box);
    }, 500);
}

// Photo Filter Functions
function triggerPhotoUpload() {
    document.getElementById('photo-input').click();
}

function addPhotoFilter(filter) {
    const img = document.querySelector('#photo-area img');
    if (!img) {
        showMessage('р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕Юр╕┤р╣Ир╕бр╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╕Бр╣Ир╕нр╕Щр╕Щр╕░р╕Др╕░ ЁЯУ╖');
        return;
    }
    
    switch(filter) {
        case 'sepia':
            img.style.filter = 'sepia(100%)';
            break;
        case 'blur':
            img.style.filter = 'blur(2px)';
            break;
        case 'brightness':
            img.style.filter = 'brightness(150%)';
            break;
    }
}

function clearPhotoFilters() {
    const img = document.querySelector('#photo-area img');
    if (img) {
        img.style.filter = 'none';
    }
}

// Fireworks Function
function triggerFireworks() {
    for (let i = 0; i < 5; i++) {
        setTimeout(() => createFirework(), i * 1000);
    }
    showMessage('ЁЯОЖ р╕Юр╕ер╕╕р╕Йр╕ер╕нр╕Зр╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф! р╕кр╕╕р╕Вр╕кр╕▒р╕Щр╕Хр╣Мр╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Фр╕Щр╕░р╕Др╕░! ЁЯОЖ');
}

function createFirework() {
    const colors = ['ЁЯОЖ', 'ЁЯОЗ', 'тЬи', 'ЁЯМЯ', 'ЁЯТл'];
    const firework = document.createElement('div');
    firework.className = 'firework';
    firework.style.left = Math.random() * 100 + 'vw';
    firework.style.top = Math.random() * 50 + 'vh';
    
    for (let i = 0; i < 12; i++) {
        const particle = document.createElement('div');
        particle.className = 'firework-particle';
        particle.textContent = colors[Math.floor(Math.random() * colors.length)];
        
        const angle = (360 / 12) * i;
        const distance = 50 + Math.random() * 50;
        
        particle.style.left = '50%';
        particle.style.top = '50%';
        particle.style.transform = `translate(-50%, -50%) rotate(${angle}deg) translateY(-${distance}px)`;
        
        firework.appendChild(particle);
    }
    
    document.body.appendChild(firework);
    
    setTimeout(() => firework.remove(), 2000);
}

// Global variables for cake and music
let candlesLit = true;
let musicPlaying = false;
let musicInterval = null;
let microphoneActive = false;

// Enhanced Cake Functions
function blowCandles() {
    if (!candlesLit) return;
    
    const flames = document.getElementById('flames');
    const blowMessage = document.getElementById('blow-message');
    
    if (flames) {
        flames.classList.add('blown-out');
        candlesLit = false;
        
        setTimeout(() => {
            flames.style.display = 'none';
        }, 500);
        
        // Show success message
        showMessage('ЁЯОЙ р╣Ар╕Ыр╣Ир╕▓р╣Ар╕Чр╕╡р╕вр╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И! р╕Вр╕нр╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕Эр╕▒р╕Щр╣Ар╕Ыр╣Зр╕Щр╕Ир╕гр╕┤р╕З! тЬи');
        createConfetti();
        
        // Update hint message
        if (blowMessage) {
            blowMessage.textContent = 'р╕Др╕ер╕┤р╕Бр╣Ар╕Др╣Йр╕Бр╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╕Ир╕╕р╕Фр╣Ар╕Чр╕╡р╕вр╕Щр╣Гр╕лр╕бр╣И!';
        }
        
        // Auto relight after 5 seconds
        setTimeout(() => {
            lightCandles();
        }, 5000);
    }
}

function lightCandles() {
    const flames = document.getElementById('flames');
    const blowMessage = document.getElementById('blow-message');
    
    if (flames) {
        flames.style.display = 'flex';
        flames.classList.remove('blown-out');
        candlesLit = true;
        
        if (blowMessage) {
            blowMessage.textContent = 'р╕ер╕нр╕Зр╕Бр╕Фр╕Ыр╕╕р╣Ир╕б B р╕лр╕гр╕╖р╕нр╕Бр╕Фр╕Чр╕╡р╣Ир╣Др╕бр╣Вр╕Др╕гр╣Вр╕Яр╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Ыр╣Ир╕▓р╕Ир╕гр╕┤р╕Зр╣Ж!';
        }
        
        showMessage('ЁЯХпя╕П р╕Ир╕╕р╕Фр╣Ар╕Чр╕╡р╕вр╕Щр╣Гр╕лр╕бр╣Ир╣Бр╕ер╣Йр╕з! р╕ер╕нр╕Зр╣Ар╕Ыр╣Ир╕▓р╕Фр╕╣р╕кр╕┤! ЁЯМмя╕П');
    }
}

// Music Functions
function toggleMusic() {
    const audio = document.getElementById('birthday-song');
    const musicBtn = document.getElementById('music-toggle');
    
    if (musicPlaying) {
        // Stop music
        audio.pause();
        musicBtn.textContent = 'ЁЯО╡ р╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕Юр╕ер╕З';
        musicBtn.classList.remove('playing');
        musicBtn.disabled = false;
        musicPlaying = false;
        showMessage('р╕Ыр╕┤р╕Фр╣Ар╕Юр╕ер╕З ЁЯФЗ');
    } else {
        // Start music
        startMusic();
    }
}

// Start Music Function
function startMusic() {
    const audio = document.getElementById('birthday-song');
    const musicBtn = document.getElementById('music-toggle');
    
    if (audio && musicBtn) {
        console.log('Attempting to start music...');
        console.log('Audio readyState:', audio.readyState);
        console.log('Audio src:', audio.currentSrc || audio.src);
        
        // Try to play the audio
        audio.play().then(() => {
            console.log('Music started successfully!');
            musicBtn.textContent = 'ЁЯО╢ р╣Ар╕ер╣Ир╕Щр╕Хр╣Ир╕нр╣Ар╕Щр╕╖р╣Ир╕нр╕З';
            musicBtn.classList.add('playing');
            musicBtn.disabled = true;
            musicPlaying = true;
            showMessage('ЁЯО╡ р╣Ар╕Юр╕ер╕З Happy Birthday р╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕ер╣Ир╕Щр╣Бр╕ер╣Йр╕з! ЁЯО╡');
            
            // Set up loop when song ends
            audio.addEventListener('ended', function() {
                console.log('Song ended, restarting...');
                audio.currentTime = 0;
                audio.play();
            });
            
        }).catch(error => {
            console.error('Could not start music automatically:', error);
            showMessage('ЁЯО╡ р╣Ар╕Юр╕ер╕Зр╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з! р╕Др╕ер╕┤р╕Бр╕Чр╕╡р╣Ир╕Ыр╕╕р╣Ир╕б Play р╣Гр╕Щ audio player р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕ер╣Ир╕Щ ЁЯО╡');
            
            // Enable the music button for manual start
            musicBtn.disabled = false;
            musicBtn.textContent = 'ЁЯО╡ р╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕Юр╕ер╕З';
            musicBtn.onclick = function() {
                audio.play().then(() => {
                    musicBtn.textContent = 'ЁЯО╢ р╣Ар╕ер╣Ир╕Щр╕Хр╣Ир╕нр╣Ар╕Щр╕╖р╣Ир╕нр╕З';
                    musicBtn.classList.add('playing');
                    musicBtn.disabled = true;
                    musicPlaying = true;
                    showMessage('ЁЯО╡ р╣Ар╕Юр╕ер╕Зр╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕ер╣Ир╕Щр╣Бр╕ер╣Йр╕з! ЁЯО╡');
                    
                    // Set up loop when song ends
                    audio.addEventListener('ended', function() {
                        audio.currentTime = 0;
                        audio.play();
                    });
                }).catch(error => {
                    console.error('Error starting music manually:', error);
                    showMessage('р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕ер╣Ир╕Щр╣Ар╕Юр╕ер╕Зр╣Др╕Фр╣Й р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Яр╕ер╣М MP3 ЁЯО╡');
                });
            };
        });
    }
}

function playBirthdayTune() {
    // Simple birthday melody using oscillator
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const notes = [
        {freq: 261.63, duration: 0.5}, // C
        {freq: 261.63, duration: 0.5}, // C
        {freq: 293.66, duration: 1},   // D
        {freq: 261.63, duration: 1},   // C
        {freq: 349.23, duration: 1},   // F
        {freq: 329.63, duration: 2},   // E
    ];
    
    let currentTime = audioContext.currentTime;
    
    notes.forEach(note => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(note.freq, currentTime);
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, currentTime);
        gainNode.gain.linearRampToValueAtTime(0.1, currentTime + 0.1);
        gainNode.gain.exponentialRampToValueAtTime(0.001, currentTime + note.duration);
        
        oscillator.start(currentTime);
        oscillator.stop(currentTime + note.duration);
        
        currentTime += note.duration;
    });
    
    // Stop music automatically after the tune
    setTimeout(() => {
        if (musicPlaying) {
            const musicBtn = document.getElementById('music-toggle');
            musicBtn.textContent = 'ЁЯО╡ р╣Ар╕Юр╕ер╕З';
            musicBtn.classList.remove('playing');
            musicPlaying = false;
        }
    }, currentTime * 1000);
}

function setVolume(value) {
    const audio = document.getElementById('birthday-song');
    if (audio) {
        audio.volume = value;
    }
}

function adjustVolume(change) {
    const slider = document.getElementById('volume-slider');
    const newValue = Math.max(0, Math.min(1, parseFloat(slider.value) + change));
    slider.value = newValue;
    setVolume(newValue);
    
    // Show volume level
    const volumeText = newValue === 0 ? 'р╕Ыр╕┤р╕Фр╣Ар╕кр╕╡р╕вр╕З' : `р╣Ар╕кр╕╡р╕вр╕З: ${Math.round(newValue * 100)}%`;
    showMessage(volumeText + ' ЁЯФК');
}

// Microphone Functions
function toggleMicrophone() {
    const micBtn = document.getElementById('mic-btn');
    
    if (!microphoneActive) {
        startMicrophone();
    } else {
        stopMicrophone();
    }
}

function startMicrophone() {
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function(stream) {
                microphoneActive = true;
                const micBtn = document.getElementById('mic-btn');
                micBtn.classList.add('active');
                micBtn.textContent = 'ЁЯОд р╕лр╕вр╕╕р╕Ф';
                
                showMessage('ЁЯОд р╣Др╕бр╣Вр╕Др╕гр╣Вр╕Яр╕Щр╣Ар╕Ыр╕┤р╕Фр╣Бр╕ер╣Йр╕з! р╕ер╕нр╕Зр╣Ар╕Ыр╣Ир╕▓р╕Фр╕╣р╕кр╕┤! ЁЯМмя╕П');
                
                // Simple volume detection for blow simulation
                const audioContext = new AudioContext();
                const analyser = audioContext.createAnalyser();
                const microphone = audioContext.createMediaStreamSource(stream);
                const dataArray = new Uint8Array(analyser.frequencyBinCount);
                
                microphone.connect(analyser);
                
                function detectBlow() {
                    analyser.getByteFrequencyData(dataArray);
                    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    
                    // If volume is high enough, simulate blowing
                    if (average > 50 && candlesLit) {
                        blowCandles();
                        stream.getTracks().forEach(track => track.stop());
                        stopMicrophone();
                        return;
                    }
                    
                    if (microphoneActive) {
                        requestAnimationFrame(detectBlow);
                    }
                }
                
                detectBlow();
                
                // Auto stop after 10 seconds
                setTimeout(() => {
                    if (microphoneActive) {
                        stream.getTracks().forEach(track => track.stop());
                        stopMicrophone();
                    }
                }, 10000);
            })
            .catch(function(err) {
                showMessage('р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╣Др╕бр╣Вр╕Др╕гр╣Вр╕Яр╕Щр╣Др╕Фр╣Й р╕Бр╕гр╕╕р╕Ур╕▓р╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ ЁЯОд');
            });
    } else {
        showMessage('р╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣Мр╣Др╕бр╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ър╣Др╕бр╣Вр╕Др╕гр╣Вр╕Яр╕Щ р╕ер╕нр╕Зр╣Гр╕Кр╣Йр╕Ыр╕╕р╣Ир╕бр╣Ар╕Ыр╣Ир╕▓р╣Бр╕Чр╕Щ! ЁЯМмя╕П');
    }
}

function stopMicrophone() {
    microphoneActive = false;
    const micBtn = document.getElementById('mic-btn');
    micBtn.classList.remove('active');
    micBtn.textContent = 'ЁЯОд р╣Др╕бр╕Др╣М';
}

// Welcome message when page loads
window.addEventListener('load', function() {
    setTimeout(() => {
        const welcomeDiv = document.createElement('div');
        welcomeDiv.innerHTML = `
            <div style="text-align: center;">
                <h2 style="color: #ff6b9d; margin-bottom: 15px;">ЁЯОЙ р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ър╕кр╕╣р╣Ир╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Фр╕Чр╕╡р╣Ир╕Юр╕┤р╣Ар╕ир╕й! ЁЯОЙ</h2>
                <p style="color: #666;">ЁЯО╡ р╣Ар╕Юр╕ер╕З Happy Birthday (Romantic Piano) р╕Ир╕░р╣Ар╕ер╣Ир╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Хр╣Ир╕нр╣Ар╕Щр╕╖р╣Ир╕нр╕З!</p>
                <p style="color: #666;">р╕Др╕ер╕┤р╕Бр╕Чр╕╡р╣Ир╕Хр╕▒р╕зр╕Бр╕▓р╕гр╣Мр╕Хр╕╣р╕Щ р╕Фр╕нр╕Бр╣Др╕бр╣Й р╣Ар╕Др╣Йр╕Б р╣Бр╕ер╕░р╕ер╕нр╕Зр╣Ар╕ер╣Ир╕Щр╣Ар╕Бр╕бр╕кр╕Щр╕╕р╕Бр╣Ж! тЬи</p>
                <p style="color: #666;">р╕ер╕нр╕Зр╣Ар╕Ыр╣Ир╕▓р╣Ар╕Чр╕╡р╕вр╕Щр╕Фр╣Йр╕зр╕вр╕Щр╕░! ЁЯМмя╕П</p>
                <p style="color: #999; font-size: 0.9rem;">* р╣Ар╕Юр╕ер╕Зр╕Ир╕░р╣Ар╕ер╣Ир╕Щр╕Хр╣Ир╕нр╣Ар╕Щр╕╖р╣Ир╕нр╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕гр╕вр╕▓р╕Бр╕▓р╕ир╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕кр╕╕р╕В</p>
            </div>
        `;
        welcomeDiv.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: messageSlideIn 0.8s ease-out;
            max-width: 90%;
            border: 3px solid #ff6b9d;
        `;
        
        document.body.appendChild(welcomeDiv);
        
        // Add close button
        const closeBtn = document.createElement('button');
        closeBtn.textContent = 'тЬи р╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щр╣Ар╕ер╕╡р╣Йр╕вр╕З тЬи';
        closeBtn.style.cssText = `
            background: #ff6b9d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            font-family: 'Kanit', sans-serif;
        `;
        
        closeBtn.addEventListener('click', function() {
            welcomeDiv.style.animation = 'messageSlideOut 0.5s ease-in forwards';
            setTimeout(() => welcomeDiv.remove(), 500);
        });
        
        welcomeDiv.appendChild(closeBtn);
        
        // Auto close after 6 seconds
        setTimeout(() => {
            if (welcomeDiv.parentNode) {
                welcomeDiv.style.animation = 'messageSlideOut 0.5s ease-in forwards';
                setTimeout(() => welcomeDiv.remove(), 500);
            }
        }, 6000);
    }, 500);
    
    // Birthday Girl Interaction
    function initBirthdayGirlInteraction() {
        const birthdayGirlImg = document.querySelector('.birthday-girl-img, .birthday-girl-placeholder');
        const birthdayMessage = document.querySelector('.birthday-message');
        
        if (birthdayGirlImg) {
            birthdayGirlImg.addEventListener('click', function() {
                const messages = [
                    'ЁЯОВ Happy Birthday! р╕Вр╕нр╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕кр╕Щр╕Юр╕┤р╣Ар╕ир╕йр╕Щр╕░! ЁЯОВ',
                    'ЁЯМЯ р╣Ар╕Шр╕нр╕Др╕╖р╕нр╕Фр╕▓р╕зр╕Фр╕зр╕Зр╕кр╕зр╣Ир╕▓р╕Зр╕Чр╕╡р╣Ир╕кр╣Ир╕нр╕Зр╣Бр╕кр╕Зр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕Др╕Щ! ЁЯМЯ',
                    'ЁЯОИ р╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕Вр╕нр╕Зр╣Ар╕Шр╕н р╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╣Ар╕вр╕нр╕░р╣Ж р╕Щр╕░! ЁЯОИ',
                    'ЁЯТЦ р╕Вр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕Др╕зр╕▓р╕бр╕Эр╕▒р╕Щр╕Вр╕нр╕Зр╣Ар╕Шр╕нр╣Ар╕Ыр╣Зр╕Щр╕Ир╕гр╕┤р╕Зр╕Чр╕╕р╕Бр╕Ыр╕гр╕░р╕Бр╕▓р╕г! ЁЯТЦ'
                ];
                
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                showMessage(randomMessage);
                createConfetti();
                createFloatingHeartsFromElement(this);
            });
            
            birthdayGirlImg.addEventListener('mouseenter', function() {
                this.style.filter = 'brightness(1.1) saturate(1.2)';
            });
            
            birthdayGirlImg.addEventListener('mouseleave', function() {
                this.style.filter = '';
            });
        }
    }
    
    // Cheer Photos Interaction
    function initCheerPhotosInteraction() {
        const cheerItems = document.querySelectorAll('.cheer-item');
        
        cheerItems.forEach((item, index) => {
            const photo = item.querySelector('.cheer-photo, .cheer-placeholder');
            
            if (photo) {
                photo.addEventListener('click', function() {
                    const messages = [
                        'ЁЯОЙ р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╣Ар╕Хр╣Зр╕бр╣Ар╕Ыр╕╡р╣Ир╕вр╕б! р╕бр╕╡р╣Бр╕Хр╣Ир╕гр╕нр╕вр╕вр╕┤р╣Йр╕бр╣Бр╕ер╕░р╣Ар╕кр╕╡р╕вр╕Зр╕лр╕▒р╕зр╣Ар╕гр╕▓р╕░! ЁЯОЙ',
                        'ЁЯОК р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓р╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕бр╕╡р╕зр╕▒р╕Щр╕ер╕╖р╕б! ЁЯОК',
                        'ЁЯОИ р╣Ар╕Хр╣Зр╕бр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╕кр╕Щр╕╕р╕Бр╕кр╕Щр╕▓р╕Щр╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╣Гр╕И! ЁЯОИ',
                        'ЁЯОБ р╕Вр╕нр╕Зр╕Вр╕зр╕▒р╕Нр╕Др╕╖р╕нр╕Др╕зр╕▓р╕бр╕Чр╕гр╕Зр╕Ир╕│р╕Фр╕╡р╣Ж р╕Чр╕╡р╣Ир╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Йр╣Гр╕Щр╣Гр╕И! ЁЯОБ'
                    ];
                    
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    showMessage(randomMessage);
                    
                    // Add special effect based on index
                    if (index === 0) createConfetti();
                    else if (index === 1) createFloatingHeartsFromElement(this);
                    else if (index === 2) {
                        createConfetti();
                        setTimeout(() => createFloatingHeartsFromElement(this), 500);
                    } else {
                        for (let i = 0; i < 3; i++) {
                            setTimeout(() => createConfetti(), i * 200);
                        }
                    }
                });
                
                photo.addEventListener('mouseenter', function() {
                    this.style.filter = 'brightness(1.1) contrast(1.1)';
                    item.style.transform = 'translateY(-15px) scale(1.02)';
                });
                
                photo.addEventListener('mouseleave', function() {
                    this.style.filter = '';
                    item.style.transform = '';
                });
            }
        });
    }
});
